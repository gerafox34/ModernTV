<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>üì∫ Modern IPTV & Radio Player</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --bg-dark: #0f172a;
      --bg-card: #1e293b;
      --bg-card-hover: #334155;
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --success: #10b981;
      --danger: #ef4444;
      --border: #475569;
      --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, var(--bg-dark) 0%, #1e1b4b 100%);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      padding-bottom: 80px;
    }

    /* Header */
    .header {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(10px);
      padding: 1.2rem 1.5rem;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .logo-icon {
      color: var(--primary);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .controls {
      display: flex;
      gap: 10px;
    }

    .control-btn {
      background: var(--bg-card);
      border: none;
      color: var(--text-secondary);
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .control-btn:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
    }

    /* Navigation */
    .nav-tabs {
      display: flex;
      background: var(--bg-card);
      margin: 1rem 1.5rem;
      border-radius: 12px;
      padding: 5px;
    }

    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-weight: 500;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .tab.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    /* Sections */
    .section {
      display: none;
      padding: 0 1.5rem;
      animation: fadeIn 0.5s ease;
    }

    .section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section-title {
      font-size: 1.3rem;
      margin-bottom: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title i {
      color: var(--primary);
    }

    /* Radio Grid */
    .radio-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 15px;
      margin-bottom: 2rem;
    }

    .radio-item {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 20px 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .radio-item:hover {
      background: var(--bg-card-hover);
      transform: translateY(-5px);
      box-shadow: var(--shadow);
    }

    .radio-item.playing {
      border-color: var(--primary);
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(99, 102, 241, 0.1) 100%);
    }

    .radio-icon {
      font-size: 2rem;
      margin-bottom: 10px;
      color: var(--primary);
    }

    .radio-name {
      font-size: 0.9rem;
      text-align: center;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 100%;
    }

    .playing-indicator {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 8px;
      height: 8px;
      background: var(--success);
      border-radius: 50%;
      animation: blink 1.5s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* TV Grid */
    .tv-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 2rem;
    }

    .tv-item {
      background: var(--bg-card);
      border-radius: 16px;
      overflow: hidden;
      aspect-ratio: 16 / 9;
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .tv-item:hover {
      transform: scale(1.03);
      box-shadow: var(--shadow);
      border-color: var(--primary);
    }

    .tv-item.active {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }

    .tv-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      background: #000;
    }

    .tv-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
      padding: 20px 15px 15px;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
    }

    .tv-title {
      font-weight: 600;
      font-size: 1rem;
    }

    .tv-status {
      background: rgba(0,0,0,0.7);
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .tv-status.playing {
      background: var(--success);
      color: white;
    }

    /* Player Modal */
    .player-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .player-modal.active {
      opacity: 1;
      visibility: visible;
    }

    .player-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
    }

    .player-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .player-close {
      background: rgba(255,255,255,0.1);
      border: none;
      color: white;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }

    .player-close:hover {
      background: var(--danger);
      transform: rotate(90deg);
    }

    .player-video {
      width: 100%;
      height: 70vh;
      max-width: 1200px;
      border-radius: 12px;
      overflow: hidden;
      background: #000;
    }

    .player-video video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* Now Playing Bar */
    .now-playing {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(20px);
      border-top: 1px solid var(--border);
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 90;
      transform: translateY(100%);
      transition: transform 0.3s ease;
    }

    .now-playing.active {
      transform: translateY(0);
    }

    .now-playing-info {
      display: flex;
      align-items: center;
      gap: 15px;
      flex: 1;
    }

    .now-playing-icon {
      font-size: 1.5rem;
      color: var(--primary);
    }

    .now-playing-text h4 {
      font-size: 1rem;
      margin-bottom: 4px;
    }

    .now-playing-text p {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .now-playing-controls {
      display: flex;
      gap: 10px;
    }

    .play-btn {
      background: var(--primary);
      border: none;
      color: white;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .play-btn:hover {
      background: var(--primary-dark);
      transform: scale(1.1);
    }

    .stop-btn {
      background: var(--danger);
      border: none;
      color: white;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .stop-btn:hover {
      transform: scale(1.1);
    }

    /* Loading */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg-dark);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      transition: opacity 0.5s ease;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 1.1rem;
      color: var(--text-secondary);
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-card);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .tv-grid {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      }
      
      .radio-grid {
        grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      }
      
      .player-video {
        height: 50vh;
      }
    }

    @media (max-width: 480px) {
      .header {
        padding: 1rem;
      }
      
      .nav-tabs, .section {
        margin-left: 1rem;
        margin-right: 1rem;
      }
      
      .tv-grid {
        grid-template-columns: 1fr;
      }
      
      .radio-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-overlay" id="loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–Ω–∞–ª–æ–≤...</div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="logo">
      <i class="fas fa-satellite-dish logo-icon"></i>
      <span>Modern IPTV</span>
    </div>
    <div class="controls">
      <button class="control-btn" id="refreshBtn" title="–û–±–Ω–æ–≤–∏—Ç—å">
        <i class="fas fa-sync-alt"></i>
      </button>
      <button class="control-btn" id="fullscreenBtn" title="–ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω">
        <i class="fas fa-expand"></i>
      </button>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="nav-tabs">
    <button class="tab active" data-tab="tv">
      <i class="fas fa-tv"></i> –¢–µ–ª–µ–∫–∞–Ω–∞–ª—ã
    </button>
    <button class="tab" data-tab="radio">
      <i class="fas fa-radio"></i> –†–∞–¥–∏–æ
    </button>
  </nav>

  <!-- TV Section -->
  <section class="section active" id="tvSection">
    <h2 class="section-title">
      <i class="fas fa-broadcast-tower"></i> –¢–µ–ª–µ–∫–∞–Ω–∞–ª—ã –æ–Ω–ª–∞–π–Ω
    </h2>
    <div class="tv-grid" id="tvGrid"></div>
  </section>

  <!-- Radio Section -->
  <section class="section" id="radioSection">
    <h2 class="section-title">
      <i class="fas fa-music"></i> –†–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏–∏
    </h2>
    <div class="radio-grid" id="radioGrid"></div>
  </section>

  <!-- Player Modal -->
  <div class="player-modal" id="playerModal">
    <div class="player-header">
      <div class="player-title" id="playerTitle">–ü—Ä–æ—Å–º–æ—Ç—Ä</div>
      <button class="player-close" id="playerClose">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="player-video">
      <video id="mainPlayer" controls autoplay playsinline></video>
    </div>
  </div>

  <!-- Now Playing Bar -->
  <div class="now-playing" id="nowPlaying">
    <div class="now-playing-info">
      <i class="fas fa-play-circle now-playing-icon"></i>
      <div class="now-playing-text">
        <h4 id="nowPlayingTitle">–°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç</h4>
        <p id="nowPlayingSubtitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏—é</p>
      </div>
    </div>
    <div class="now-playing-controls">
      <button class="play-btn" id="playPauseBtn">
        <i class="fas fa-pause"></i>
      </button>
      <button class="stop-btn" id="stopBtn">
        <i class="fas fa-stop"></i>
      </button>
    </div>
  </div>

  <script>
    // Configuration
    const config = {
      autoplayAll: true,
      preloadVideos: true,
      crossOrigin: 'anonymous'
    };

    // State management
    const state = {
      currentTab: 'tv',
      playingRadio: null,
      playingTV: null,
      isRadioPlaying: false,
      fullscreen: false,
      allVideos: []
    };

    // DOM Elements
    const elements = {
      loading: document.getElementById('loading'),
      tvGrid: document.getElementById('tvGrid'),
      radioGrid: document.getElementById('radioGrid'),
      playerModal: document.getElementById('playerModal'),
      mainPlayer: document.getElementById('mainPlayer'),
      playerTitle: document.getElementById('playerTitle'),
      playerClose: document.getElementById('playerClose'),
      nowPlaying: document.getElementById('nowPlaying'),
      nowPlayingTitle: document.getElementById('nowPlayingTitle'),
      nowPlayingSubtitle: document.getElementById('nowPlayingSubtitle'),
      playPauseBtn: document.getElementById('playPauseBtn'),
      stopBtn: document.getElementById('stopBtn'),
      refreshBtn: document.getElementById('refreshBtn'),
      fullscreenBtn: document.getElementById('fullscreenBtn'),
      tabs: document.querySelectorAll('.tab'),
      sections: document.querySelectorAll('.section')
    };

    // Radio Stations
    const radioStations = [
      { name: "–ï–≤—Ä–æ–ø–∞ –ü–ª—é—Å", url: "https://ep128.hostingradio.ru:8052/europaplus128.mp3", icon: "fas fa-globe-europe" },
      { name: "–ê–≤—Ç–æ—Ä–∞–¥–∏–æ", url: "https://pub0301.101.ru:8443/stream/air/aac/64/200", icon: "fas fa-car" },
      { name: "–†—É—Å—Å–∫–æ–µ –†–∞–¥–∏–æ", url: "https://rusradio.hostingradio.ru/rusradio96.aacp", icon: "fas fa-flag" },
      { name: "DFM", url: "https://dfm.hostingradio.ru/dfm96.aacp", icon: "fas fa-music" },
      { name: "–ù–∞—à–µ –†–∞–¥–∏–æ", url: "https://nashe1.hostingradio.ru/nashe-256", icon: "fas fa-guitar" },
      { name: "–ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç FM", url: "https://kommersant77.hostingradio.ru:8014/kommersant128.mp3", icon: "fas fa-newspaper" },
      { name: "–†–∞–¥–∏–æ –í–µ—Ä–∞", url: "https://radiovera.hostingradio.ru:8000/radiovera-256.mp3", icon: "fas fa-church" },
      { name: "Rock Radio", url: "https://rockradio.hostingradio.ru:8052/rock128.mp3", icon: "fas fa-guitar" },
      { name: "–î–æ—Ä–æ–∂–Ω–æ–µ –†–∞–¥–∏–æ", url: "https://dorognoe.hostingradio.ru/radio", icon: "fas fa-road" }
    ];

    // TV Channels
    const tvChannels = [
      { name: "–ß–µ", url: "https://cdn4.skygo.mn/live/disk1/Che/HLSv3-FTA/Che.m3u8" },
      { name: "–ü—è—Ç–Ω–∏—Ü–∞ –∏–Ω—Ç–µ—Ä", url: "https://cdn4.skygo.mn/live/disk1/Friday/HLSv3-FTA/Friday.m3u8" },
      { name: "–ü—è—Ç–Ω–∏—Ü–∞", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_PYATNIZZA/variant.m3u8" },
      { name: "–ú–∞—Ç—á –¢–í", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_MATCHTV/variant.m3u8" },
      { name: "–†–ï–ù –¢–í", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_RENTV/variant.m3u8" },
      { name: "–°–¢–°", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_STS/variant.m3u8" },
      { name: "–°–¢–°LOVE", url: "http://zabava-htlive.cdn.ngenix.net/hls/CH_STSLOVE/variant.m3u8" },
      { name: "–¢–ù–¢", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_TNT/variant.m3u8" },
      { name: "–¢–ù–¢4", url: "https://cdn4.skygo.mn/live/disk1/TNT4/HLSv3-FTA/TNT4.m3u8" },
      { name: "–Æ", url: "http://zabava-htlive.cdn.ngenix.net/hls/CH_U/variant.m3u8" },
      { name: "–°—É–±–±–æ—Ç–∞", url: "http://zabava-htlive.cdn.ngenix.net/hls/CH_SUPER/variant.m3u8" },
      { name: "2X2", url: "http://zabava-htlive.cdn.ngenix.net/hls/CH_2X2/variant.m3u8" },
      { name: "–ú—É–∑ –¢–í", url: "http://zabava-htlive.cdn.ngenix.net/hls/CH_MUZTV/variant.m3u8" },
      { name: "Kino-1", url: "https://kino-1.catcast.tv/content/38617/index.m3u8" },
      { name: "–ú–∏—Ä", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_MIR/variant.m3u8" },
      { name: "–ù–¢–í", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_NTV/variant.m3u8" },
      { name: "–†–æ—Å—Å–∏—è-1", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_RUSSIA1/variant.m3u8" },
      { name: "–†–û–°–°–ò–Ø24", url: "http://zabava-htlive.cdn.ngenix.net/hls/CH_RUSSIA24/variant.m3u8" },
      { name: "1–¢–í", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_1TVSD/variant.m3u8" },
      { name: "–ö–∞–º–∏–Ω", url: "https://rt-vlg-nn-htlive.cdn.ngenix.net/hls/CH_R05_KAMINTV/variant.m3u8" },
      { name: "–¢–í –¶–µ–Ω—Ç—Ä", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_TVC/variant.m3u8" },
      { name: "5 –ö–∞–Ω–∞–ª", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_5TV/variant.m3u8" },
      { name: "–î–æ–º–∞—à–Ω–∏–π", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_DOMASHNIY/variant.m3u8" },
      { name: "–ö—É–ª—å—Ç—É—Ä–∞", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_RUSSIAK/variant.m3u8" },
      { name: "–ó–≤–µ–∑–¥–∞", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_ZVEZDA/variant.m3u8" },
      { name: "–û–¢–†", url: "https://zabava-htlive.cdn.ngenix.net/hls/CH_OTR/variant.m3u8" },
      { name: "–ó–≤–µ–∑–¥–∞+", url: "https://tvzvezda.bonus-tv.ru/cdn/zvezdaplus/mono.ts.m3u8" },
      { name: "–¢–í –ö–†–´–ú", url: "https://live1.1tvcrimea.ru/1tvcrimea.m3u8" },
      { name: "Eurosport 4K", url: "http://6f1f83d9.akadatel.com/iptv/ET85VGCD8YTWLC/31475/index.m3u8" },
      { name: "Eurosport 1 HD", url: "http://6f1f83d9.akadatel.com/iptv/ET85VGCD8YTWLC/228/index.m3u8" },
      { name: "Eurosport 2 HD", url: "http://6f1f83d9.akadatel.com/iptv/ET85VGCD8YTWLC/234/index.m3u8" },
      { name: "–ú–æ—è –ü–ª–∞–Ω–µ—Ç–∞", url: "http://194.143.148.28:8080/Nauka20/mpegts" }
    ];

    // Initialize the application
    document.addEventListener('DOMContentLoaded', async () => {
      initNavigation();
      renderRadioStations();
      await renderTVChannels();
      initEventListeners();
      
      // Auto-play all channels on load
      if (config.autoplayAll) {
        await autoPlayAllChannels();
      }
      
      // Hide loading screen
      setTimeout(() => {
        elements.loading.style.opacity = '0';
        setTimeout(() => {
          elements.loading.style.display = 'none';
        }, 500);
      }, 1500);
    });

    // Navigation
    function initNavigation() {
      elements.tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabId = tab.dataset.tab;
          state.currentTab = tabId;
          
          // Update active tab
          elements.tabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          // Show corresponding section
          elements.sections.forEach(section => {
            section.classList.remove('active');
            if (section.id === `${tabId}Section`) {
              section.classList.add('active');
            }
          });
        });
      });
    }

    // Render radio stations
    function renderRadioStations() {
      radioStations.forEach((station, index) => {
        const item = document.createElement('div');
        item.className = 'radio-item';
        item.dataset.index = index;
        item.innerHTML = `
          <i class="${station.icon} radio-icon"></i>
          <div class="radio-name">${station.name}</div>
          <div class="playing-indicator" style="display: none;"></div>
        `;
        
        item.addEventListener('click', () => playRadio(station, index));
        elements.radioGrid.appendChild(item);
      });
    }

    // Render TV channels with auto-play
    async function renderTVChannels() {
      for (const [index, channel] of tvChannels.entries()) {
        const item = document.createElement('div');
        item.className = 'tv-item';
        item.dataset.index = index;
        
        const video = document.createElement('video');
        video.className = 'tv-video';
        video.muted = true;
        video.playsInline = true;
        video.preload = 'auto';
        video.crossOrigin = config.crossOrigin;
        video.poster = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="320" height="180"><rect width="100%" height="100%" fill="%231e293b"/><text x="50%" y="50%" font-family="Arial" font-size="16" fill="%23cbd5e1" text-anchor="middle" dy=".3em">${channel.name}</text></svg>';
        
        const overlay = document.createElement('div');
        overlay.className = 'tv-overlay';
        overlay.innerHTML = `
          <div class="tv-title">${channel.name}</div>
          <div class="tv-status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        `;
        
        item.appendChild(video);
        item.appendChild(overlay);
        
        // Store video reference
        state.allVideos.push({ video, channel, item });
        
        item.addEventListener('click', () => playTV(channel, index));
        elements.tvGrid.appendChild(item);
        
        // Preload video
        if (config.preloadVideos) {
          setTimeout(() => {
            video.src = channel.url;
            video.load();
            
            video.addEventListener('loadeddata', () => {
              overlay.querySelector('.tv-status').textContent = '–ì–æ—Ç–æ–≤';
              overlay.querySelector('.tv-status').classList.add('playing');
            });
            
            video.addEventListener('error', () => {
              overlay.querySelector('.tv-status').textContent = '–û—à–∏–±–∫–∞';
              overlay.querySelector('.tv-status').style.color = 'var(--danger)';
            });
          }, index * 300); // Stagger loading
        }
      }
    }

    // Auto-play all channels
    async function autoPlayAllChannels() {
      console.log('–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤...');
      
      state.allVideos.forEach((item, index) => {
        setTimeout(() => {
          try {
            if (item.video && item.channel.url) {
              item.video.play().catch(e => {
                console.log(`–ö–∞–Ω–∞–ª "${item.channel.name}" –Ω–µ –º–æ–∂–µ—Ç –∞–≤—Ç–æ–∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è:`, e.message);
              });
            }
          } catch (error) {
            console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–µ –∫–∞–Ω–∞–ª–∞ ${index}:`, error);
          }
        }, index * 500); // Stagger autoplay to avoid overwhelming
      });
    }

    // Play radio station
    function playRadio(station, index) {
      if (state.playingRadio === index) return;
      
      // Stop current radio if playing
      if (state.playingRadio !== null) {
        const prevItem = elements.radioGrid.querySelector(`.radio-item[data-index="${state.playingRadio}"]`);
        if (prevItem) {
          prevItem.classList.remove('playing');
          prevItem.querySelector('.playing-indicator').style.display = 'none';
        }
      }
      
      // Stop TV if playing
      if (state.playingTV !== null) {
        stopTV();
      }
      
      // Create new audio element
      const audio = new Audio(station.url);
      audio.crossOrigin = 'anonymous';
      
      audio.play().then(() => {
        state.playingRadio = index;
        state.isRadioPlaying = true;
        
        // Update UI
        const item = elements.radioGrid.querySelector(`.radio-item[data-index="${index}"]`);
        item.classList.add('playing');
        item.querySelector('.playing-indicator').style.display = 'block';
        
        // Update now playing bar
        elements.nowPlayingTitle.textContent = station.name;
        elements.nowPlayingSubtitle.textContent = '–°–ª—É—à–∞–π—Ç–µ —Ä–∞–¥–∏–æ –æ–Ω–ª–∞–π–Ω';
        elements.nowPlaying.classList.add('active');
        elements.playPauseBtn.querySelector('i').className = 'fas fa-pause';
        
        // Store audio reference
        state.currentAudio = audio;
        
        // Handle audio events
        audio.addEventListener('error', (e) => {
          console.error('Radio error:', e);
          elements.nowPlayingSubtitle.textContent = '–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è';
        });
        
        audio.addEventListener('ended', () => {
          stopRadio();
        });
        
      }).catch(error => {
        console.error('Failed to play radio:', error);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ä–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏—é. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
      });
    }

    // Play TV channel
    function playTV(channel, index) {
      if (!channel.url) {
        alert('–≠—Ç–æ—Ç –∫–∞–Ω–∞–ª –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        return;
      }
      
      // Stop radio if playing
      if (state.playingRadio !== null) {
        stopRadio();
      }
      
      // Update active TV item
      if (state.playingTV !== null) {
        const prevItem = elements.tvGrid.querySelector(`.tv-item[data-index="${state.playingTV}"]`);
        if (prevItem) prevItem.classList.remove('active');
      }
      
      const item = elements.tvGrid.querySelector(`.tv-item[data-index="${index}"]`);
      item.classList.add('active');
      state.playingTV = index;
      
      // Show player modal
      elements.playerTitle.textContent = channel.name;
      elements.mainPlayer.src = channel.url;
      elements.playerModal.classList.add('active');
      document.body.style.overflow = 'hidden';
      
      // Try to play
      elements.mainPlayer.play().catch(error => {
        console.error('Failed to play TV:', error);
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∫–∞–Ω–∞–ª. –í–æ–∑–º–æ–∂–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.');
      });
    }

    // Stop radio
    function stopRadio() {
      if (state.currentAudio) {
        state.currentAudio.pause();
        state.currentAudio = null;
      }
      
      if (state.playingRadio !== null) {
        const item = elements.radioGrid.querySelector(`.radio-item[data-index="${state.playingRadio}"]`);
        if (item) {
          item.classList.remove('playing');
          item.querySelector('.playing-indicator').style.display = 'none';
        }
      }
      
      state.playingRadio = null;
      state.isRadioPlaying = false;
      elements.nowPlaying.classList.remove('active');
    }

    // Stop TV
    function stopTV() {
      if (state.playingTV !== null) {
        const item = elements.tvGrid.querySelector(`.tv-item[data-index="${state.playingTV}"]`);
        if (item) item.classList.remove('active');
        state.playingTV = null;
      }
      
      elements.mainPlayer.pause();
      elements.mainPlayer.src = '';
      elements.playerModal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    // Initialize event listeners
    function initEventListeners() {
      // Player controls
      elements.playerClose.addEventListener('click', stopTV);
      
      elements.playPauseBtn.addEventListener('click', () => {
        if (state.isRadioPlaying && state.currentAudio) {
          if (state.currentAudio.paused) {
            state.currentAudio.play();
            elements.playPauseBtn.querySelector('i').className = 'fas fa-pause';
          } else {
            state.currentAudio.pause();
            elements.playPauseBtn.querySelector('i').className = 'fas fa-play';
          }
        }
      });
      
      elements.stopBtn.addEventListener('click', stopRadio);
      
      // Refresh button
      elements.refreshBtn.addEventListener('click', async () => {
        if (state.currentTab === 'tv') {
          stopTV();
          elements.tvGrid.innerHTML = '';
          state.allVideos = [];
          await renderTVChannels();
          if (config.autoplayAll) {
            await autoPlayAllChannels();
          }
        } else {
          stopRadio();
        }
      });
      
      // Fullscreen button
      elements.fullscreenBtn.addEventListener('click', () => {
        if (!state.fullscreen) {
          if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
          } else if (document.documentElement.webkitRequestFullscreen) {
            document.documentElement.webkitRequestFullscreen();
          } else if (document.documentElement.msRequestFullscreen) {
            document.documentElement.msRequestFullscreen();
          }
          state.fullscreen = true;
        } else {
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
          }
          state.fullscreen = false;
        }
      });
      
      // Close player with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          if (elements.playerModal.classList.contains('active')) {
            stopTV();
          }
          if (state.fullscreen) {
            elements.fullscreenBtn.click();
          }
        }
      });
      
      // Handle fullscreen change
      document.addEventListener('fullscreenchange', () => {
        state.fullscreen = !!document.fullscreenElement;
      });
      
      document.addEventListener('webkitfullscreenchange', () => {
        state.fullscreen = !!document.webkitFullscreenElement;
      });
      
      document.addEventListener('msfullscreenchange', () => {
        state.fullscreen = !!document.msFullscreenElement;
      });
    }

    // Handle iOS specific requirements
    function handleIOSFeatures() {
      // iOS requires user gesture for audio/video playback
      document.addEventListener('touchstart', function initAudio() {
        // This enables audio context on iOS
        if (typeof AudioContext !== 'undefined') {
          const audioContext = new (window.AudioContext || window.webkitAudioContext)();
          audioContext.resume();
        }
        document.removeEventListener('touchstart', initAudio);
      }, { once: true });
    }

    // Initialize iOS features
    if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {
      handleIOSFeatures();
    }
  </script>
</body>
</html>
